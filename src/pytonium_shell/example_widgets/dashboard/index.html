<!DOCTYPE html>
<html>
<head>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        background: transparent;
        font-family: var(--shell-font, 'Segoe UI', sans-serif);
        color: var(--shell-foreground, #c0caf5);
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.25s ease;
    }
    body.fade-in { opacity: 1; }
    body.fade-out { opacity: 0; }

    .overlay {
        width: 100vw;
        height: 100vh;
        background: rgba(15, 15, 25, 0.82);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px;
    }

    .header {
        text-align: center;
        margin-bottom: 48px;
    }
    .clock {
        font-size: 72px;
        font-weight: 200;
        letter-spacing: 4px;
        color: #c0caf5;
    }
    .date-line {
        font-size: 18px;
        color: var(--shell-muted, #565f89);
        margin-top: 8px;
        letter-spacing: 2px;
    }

    .cards {
        display: grid;
        grid-template-columns: repeat(4, 240px);
        gap: 24px;
    }
    .card {
        background: rgba(30, 32, 48, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        padding: 24px;
        text-align: center;
    }
    .card-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        color: var(--shell-muted, #565f89);
        margin-bottom: 16px;
    }
    .card-value {
        font-size: 40px;
        font-weight: 300;
    }
    .card-sub {
        font-size: 13px;
        color: var(--shell-muted, #565f89);
        margin-top: 8px;
    }
    .bar-bg {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.06);
        border-radius: 2px;
        margin-top: 16px;
    }
    .bar-fill {
        height: 100%;
        border-radius: 2px;
        transition: width 0.5s ease;
    }

    .cpu .card-value { color: var(--shell-accent, #7aa2f7); }
    .cpu .bar-fill { background: var(--shell-accent, #7aa2f7); }

    .mem .card-value { color: var(--shell-accent2, #bb9af7); }
    .mem .bar-fill { background: var(--shell-accent2, #bb9af7); }

    .disk .card-value { color: var(--shell-success, #9ece6a); }
    .disk .bar-fill { background: var(--shell-success, #9ece6a); }

    .net .card-value { color: #f7768e; }

    .hint {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: rgba(255, 255, 255, 0.2);
        letter-spacing: 1px;
    }
</style>
</head>
<body>
<div class="overlay">
    <div class="header">
        <div class="clock" id="clock">--:--</div>
        <div class="date-line" id="date-line">---</div>
    </div>

    <div class="cards">
        <div class="card cpu">
            <div class="card-title">CPU</div>
            <div class="card-value" id="cpu-val">0%</div>
            <div class="bar-bg"><div class="bar-fill" id="cpu-bar" style="width: 0%"></div></div>
        </div>
        <div class="card mem">
            <div class="card-title">Memory</div>
            <div class="card-value" id="mem-val">0%</div>
            <div class="card-sub" id="mem-sub">-</div>
            <div class="bar-bg"><div class="bar-fill" id="mem-bar" style="width: 0%"></div></div>
        </div>
        <div class="card disk">
            <div class="card-title">Disk</div>
            <div class="card-value" id="disk-val">0%</div>
            <div class="card-sub" id="disk-sub">-</div>
            <div class="bar-bg"><div class="bar-fill" id="disk-bar" style="width: 0%"></div></div>
        </div>
        <div class="card net">
            <div class="card-title">Network</div>
            <div class="card-value" id="net-val">-</div>
            <div class="card-sub" id="net-sub">-</div>
        </div>
    </div>
</div>

<div class="hint">Ctrl + Alt + D to toggle</div>

<script>
var memTotal = 0;
var diskTotal = 0;
var lastNetSent = 0;
var lastNetRecv = 0;

function formatBytes(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
    if (bytes < 1073741824) return (bytes / 1048576).toFixed(1) + ' MB';
    return (bytes / 1073741824).toFixed(1) + ' GB';
}

function formatRate(bytes) {
    if (bytes < 1024) return bytes + ' B/s';
    if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB/s';
    return (bytes / 1048576).toFixed(1) + ' MB/s';
}

function init() {
    Pytonium.appState.registerForStateUpdates(
        "dashDatetime", ["datetime"], true, true
    );
    Pytonium.appState.registerForStateUpdates(
        "dashSystem", ["system"], true, true
    );

    document.addEventListener("dashDatetime", function(e) {
        var key = e.detail.key;
        var value = e.detail.value;
        if (key === "time") {
            document.getElementById("clock").textContent = value;
        }
        if (key === "date" || key === "day") {
            updateDateLine();
        }
    });

    document.addEventListener("dashSystem", function(e) {
        var key = e.detail.key;
        var value = e.detail.value;

        if (key === "cpu_avg") {
            var pct = Math.round(value);
            document.getElementById("cpu-val").textContent = pct + "%";
            document.getElementById("cpu-bar").style.width = pct + "%";
        }
        if (key === "mem_percent") {
            var pct = Math.round(value);
            document.getElementById("mem-val").textContent = pct + "%";
            document.getElementById("mem-bar").style.width = pct + "%";
        }
        if (key === "mem_total") { memTotal = value; updateMemSub(); }
        if (key === "mem_used") { updateMemSub(); }
        if (key === "disk_percent") {
            var pct = Math.round(value);
            document.getElementById("disk-val").textContent = pct + "%";
            document.getElementById("disk-bar").style.width = pct + "%";
        }
        if (key === "disk_total") { diskTotal = value; updateDiskSub(); }
        if (key === "disk_used") { updateDiskSub(); }
        if (key === "net_sent") {
            var delta = lastNetSent > 0 ? value - lastNetSent : 0;
            lastNetSent = value;
            document.getElementById("net-val").textContent = formatRate(delta);
            document.getElementById("net-sub").textContent =
                "Up: " + formatBytes(value);
        }
        if (key === "net_recv") {
            var delta = lastNetRecv > 0 ? value - lastNetRecv : 0;
            lastNetRecv = value;
            document.getElementById("net-sub").textContent =
                "Down: " + formatRate(delta) + " / Up: " + formatRate(0);
            // Simplified: just show total received
            document.getElementById("net-val").textContent = formatRate(delta);
            document.getElementById("net-sub").textContent =
                "Total: " + formatBytes(value);
        }
    });
}

function updateDateLine() {
    // Will be filled by state updates
}

function updateMemSub() {
    if (memTotal > 0) {
        document.getElementById("mem-sub").textContent =
            formatBytes(memTotal) + " total";
    }
}

function updateDiskSub() {
    if (diskTotal > 0) {
        document.getElementById("disk-sub").textContent =
            formatBytes(diskTotal) + " total";
    }
}

if (window.PytoniumReady) { init(); }
else { window.addEventListener("PytoniumReady", init); }
</script>
</body>
</html>
